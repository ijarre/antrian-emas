<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Screenshots - ANTAM Bot</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <link href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.7.2/font/bootstrap-icons.css" rel="stylesheet">
    <style>
        .screenshot-thumbnail {
            max-width: 200px;
            max-height: 150px;
            cursor: pointer;
            border: 2px solid #ddd;
            border-radius: 8px;
            transition: border-color 0.3s;
        }

        .screenshot-thumbnail:hover {
            border-color: #379777;
        }

        .screenshot-modal img {
            max-width: 100%;
            max-height: 80vh;
            object-fit: contain;
        }
    </style>
</head>

<body class="bg-light">

    <nav class="navbar navbar-expand-lg navbar-dark" style="background-color: #379777;">
        <div class="container">
            <a class="navbar-brand" href="/">
                <i class="bi bi-robot"></i>
                ANTAM Bot Control Panel
            </a>

            <div class="navbar-nav">
                <a class="nav-link" href="/">Dashboard</a>
                <a class="nav-link" href="/schedules">Schedules</a>
                <a class="nav-link" href="/add-task">Add Task</a>
                <a class="nav-link" href="/settings">Settings</a>
                <span class="nav-link active">
                    <i class="bi bi-camera"></i>
                    Screenshots
                </span>
            </div>
        </div>
    </nav>

    <div class="container mt-4">
        <!-- Flash Messages -->
        {% with messages = get_flashed_messages(with_categories=true) %}
        {% if messages %}
        {% for category, message in messages %}
        <div class="alert alert-{{ 'success' if category == 'success' else 'warning' if category == 'warning' else 'danger' }} alert-dismissible fade show"
            role="alert">
            {{ message }}
            <button type="button" class="btn-close" data-bs-dismiss="alert" aria-label="Close"></button>
        </div>
        {% endfor %}
        {% endif %}
        {% endwith %}

        <div class="row">
            <div class="col-12">
                <div class="card">
                    <div class="card-header d-flex justify-content-between align-items-center">
                        <h5 class="mb-0">
                            <i class="bi bi-camera-fill"></i>
                            Bot Screenshots
                        </h5>
                        <small class="text-muted">{{ screenshots|length }} screenshots found</small>
                    </div>
                    <div class="card-body">
                        {% if screenshots %}
                        <div class="row">
                            {% for screenshot in screenshots %}
                            <div class="col-md-6 col-lg-4 mb-4">
                                <div class="card h-100">
                                    <div class="card-body text-center">
                                        <img src="/debug/screenshots/{{ screenshot.filename }}"
                                             class="screenshot-thumbnail mb-3"
                                             alt="{{ screenshot.filename }}"
                                             onclick="showModal('{{ screenshot.filename }}')">

                                        <h6 class="card-title">{{ screenshot.filename }}</h6>
                                        <div class="text-muted small">
                                            <div><i class="bi bi-calendar3"></i> {{ screenshot.modified }}</div>
                                            <div><i class="bi bi-file-earmark"></i> {{ screenshot.size }}</div>
                                        </div>

                                        <div class="mt-3">
                                            <button class="btn btn-sm btn-outline-primary"
                                                    onclick="showModal('{{ screenshot.filename }}')">
                                                <i class="bi bi-eye"></i>
                                                View
                                            </button>
                                            <a href="/debug/screenshots/{{ screenshot.filename }}"
                                               download class="btn btn-sm btn-outline-secondary">
                                                <i class="bi bi-download"></i>
                                                Download
                                            </a>
                                        </div>
                                    </div>
                                </div>
                            </div>
                            {% endfor %}
                        </div>
                        {% else %}
                        <div class="text-center text-muted py-5">
                            <i class="bi bi-camera-fill fs-1"></i>
                            <h5 class="mt-3">No Screenshots Found</h5>
                            <p>Screenshots will appear here when bots take them during runs</p>
                            <a href="/" class="btn btn-primary">
                                <i class="bi bi-arrow-left"></i>
                                Back to Dashboard
                            </a>
                        </div>
                        {% endif %}
                    </div>
                </div>

                {% if screenshots %}
                <div class="card mt-4">
                    <div class="card-header">
                        <h6 class="mb-0">
                            <i class="bi bi-info-circle"></i>
                            About Screenshots
                        </h6>
                    </div>
                    <div class="card-body">
                        <div class="row">
                            <div class="col-md-6">
                                <h6>What are these?</h6>
                                <ul class="small">
                                    <li>Screenshots taken by bots during form filling</li>
                                    <li>Useful for debugging and monitoring bot behavior</li>
                                    <li>Automatically captured when bots encounter issues</li>
                                </ul>
                            </div>
                            <div class="col-md-6">
                                <h6>Privacy & Security</h6>
                                <ul class="small">
                                    <li>Screenshots are stored locally on your machine</li>
                                    <li>Access requires admin authentication</li>
                                    <li>Contains form data - handle with care</li>
                                </ul>
                            </div>
                        </div>
                    </div>
                </div>
                {% endif %}
            </div>
        </div>
    </div>

    <!-- Screenshot Modal -->
    <div class="modal fade" id="screenshotModal" tabindex="-1" aria-labelledby="screenshotModalLabel" aria-hidden="true">
        <div class="modal-dialog modal-xl">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title" id="screenshotModalLabel">Screenshot</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                </div>
                <div class="modal-body text-center screenshot-modal">
                    <img id="modalImage" src="" alt="Screenshot">
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Close</button>
                    <a id="downloadLink" href="" download class="btn btn-primary">
                        <i class="bi bi-download"></i>
                        Download
                    </a>
                </div>
            </div>
        </div>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
    <script>
        function showModal(filename) {
            const modal = new bootstrap.Modal(document.getElementById('screenshotModal'));
            const modalImage = document.getElementById('modalImage');
            const downloadLink = document.getElementById('downloadLink');
            const modalTitle = document.getElementById('screenshotModalLabel');

            modalImage.src = '/debug/screenshots/' + filename;
            downloadLink.href = '/debug/screenshots/' + filename;
            modalTitle.textContent = filename;

            modal.show();
        }

        // Auto-refresh every 30 seconds
        setInterval(() => {
            location.reload();
        }, 30000);
    </script>

</body>

</html>